---
import Layout from "../../components/Layout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => new Date(b.data.date ?? 0).getTime() - new Date(a.data.date ?? 0).getTime());

const formatDate = (d: unknown) => {
  const dt = d instanceof Date ? d : typeof d === "string" ? new Date(d) : null;
  return dt && Number.isFinite(dt.getTime()) ? dt.toLocaleDateString() : "";
};
---

<Layout
  title="Blog | Donald Clark"
  description="Write-ups, troubleshooting notes, and project logs as I build my IT skills."
>
  <div class="not-prose mb-8">
    <h1 class="text-4xl font-extrabold tracking-tight text-slate-900">Blog</h1>
    <p class="mt-2 max-w-2xl text-slate-600">
      Write-ups, troubleshooting notes, and project logs as I build my IT skills.
    </p>
  </div>

  {posts.length === 0 ? (
    <div class="rounded-xl border border-slate-200 bg-white p-6 text-slate-600">
      No posts yet. Add a markdown file in <code class="font-mono">src/content/blog</code>.
    </div>
  ) : (
    <div class="grid gap-4 md:grid-cols-2">
      {posts.map((p) => (
        <a
          href={`/blog/${p.slug}/`}
          class="block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-200 hover:shadow-md"
        >
          <div class="flex items-start justify-between gap-3">
            <h2 class="text-lg font-semibold text-slate-900">
              {p.data.title ?? p.slug}
            </h2>
            {p.data.date && (
              <span class="whitespace-nowrap text-xs text-slate-500">
                {formatDate(p.data.date)}
              </span>
            )}
          </div>

          <p class="mt-2 text-sm text-slate-600">
            {p.data.summary ?? "No summary yet."}
          </p>

          <div class="mt-4 text-sm font-medium text-indigo-600">Read â†’</div>
        </a>
      ))}
    </div>
  )}
</Layout>
